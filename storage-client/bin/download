#!/bin/bash

#
# Usage: icgc-download.sh object-id output-dir
#

: "${DCC_HOME:?Need to set environment variable DCC_HOME}"
: "${ACCESS_TOKEN:?Need to set environment variable ACCESS_TOKEN}"
: "${UCSC_STORAGE_METADATA-SERVER:?Need to set environment variable UCSC_STORAGE_METADATA_SERVER}"
: "${UCSC_STORAGE_STORAGE_SERVER:?Need to set environment variable UCSC_STORAGE_STORAGE_SERVER}"
: "${UCSC_STORAGE_TRUSTSTORE_PASSWORD:?Need to set environment variable UCSC_STORAGE_TRUSTSTORE_PASSWORD}"

# config
accessToken=${ACCESS_TOKEN}
metadata_server_url=${UCSC_STORAGE_METADATA_SERVER}
storage_server_url=${UCSC_STORAGE_STORAGE_SERVER}
trust_store_path=${DCC_HOME}/ucsc-storage-client/conf/cacerts
trust_store_pass=${UCSC_STORAGE_TRUSTSTORE_PASSWORD}

# setup
object=$1
download=$2

# perform download
java -Djavax.net.ssl.trustStore=${trust_store_path} -Djavax.net.ssl.trustStorePassword=${trust_store_pass} -Dmetadata.url=${metadata_server_url} -Dmetadata.ssl.enabled=true -Dclient.ssl.custom=false -Dstorage.url=${storage_server_url} -DaccessToken=${accessToken} -jar ${DCC_HOME}/ucsc-storage-client/lib/icgc-storage-client-1.0.14-SNAPSHOT/lib/icgc-storage-client.jar download --output-dir ${download} --object-id ${object} --output-layout bundle
